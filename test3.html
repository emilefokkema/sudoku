<html>
<body>
<script src="makeModule.js"></script>
<script src="makeNode.js"></script>
<script>
(function(){
	var sender = function(){
		var todo= [];
		var f = function(){
			var args = arguments;
			todo.map(function(g){
				g.apply(null, args);
			});
		};
		f.add = function(g){todo.push(g);return f;};
		return f;
	};
	var step = (function(){
		var s = function(execute){
			var finish = function(){};
			var exec = function(context){
				finish = execute(context || {}, function(){finish();});
				return finish || function(){};
			};
			exec.then = function(otherStep){
				return s(function(context, finish){
					var stop2 = function(){}, stop = execute(context, function(){
						stop2 = otherStep.then(s(function(){finish();}))(context);
						
					});
					return function(){
						stop2();
						(stop || function(){})();
						
					};
				});
			};
			return exec;
		};
		return s;
	})();

	var chooser = (function(){
		var ch = function(selector, send){
			
		};

	})();
	



	var chooseOne = step(function(context, finish){
		var choice = makeNode("<div><input type='button' value='1' id='1'/><input type='button' value='2' id='2'/></div>", function(b1, b2){
			b1.onclick = function(){
				context.value = 1;finish();
			};
			b2.onclick = function(){context.value = 2;finish();};
		});
		document.body.appendChild(choice);
		return function(){
			document.body.removeChild(choice);
		};
	});

	

	var display = step(function(context, finish){
		console.log(context);
		finish();
	});

	window.stop = chooseOne.then(chooseOne).then(display)();
})();
</script>
</body>
</html>