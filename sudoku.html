<html>
<head>
<title>Sudoku</title>
<meta name="viewport" content="width=475,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
</head>
<body></body>
<script src="makeNode.js"></script>
<script language="JavaScript">
(function(b, setHash, getHash){
	var sheet=makeNode('<style id="1"></style>',
		function(s){
			document.head.appendChild(s);
			return s.sheet;
		});
	sheet.insertRule('.sudoku-button {width:75px;height:30px;cursor:pointer;margin:0px;font-family:Verdana;font-size:12px;font-weight: bold;margin:5px;border:1pt solid #000;background-color:#fff;}', 0);
	sheet.insertRule('.sudoku-button:hover {background-color: #dddddd;}', 1);
	sheet.insertRule('.sudoku-switch {cursor:pointer;height:35px;width:100%;font-family:Verdana;font-size:12px;font-weight:bold;margin:0px;background-color:#fff}',2);

	var timedOutWhile=function(condition, whatToDo, whatToDoAfter){
		var step=function(){
			condition(function(bool){
				if(bool){
					setTimeout(function(){whatToDo(step);}, 50);
				}else{
					if(whatToDoAfter){whatToDoAfter();}
				}
			});
		};
		step();
	};

	var maak=(function(){
		var maak=function(tagName){
			var node=document.createElement(tagName);
			node.met=function(attr, val){
				node.setAttribute(attr, val);
				return node;
			};
			return node;
		};
		maak.kind=function(parent, child){
			parent.appendChild(child);
			return parent;
		};
		maak.tekst=function(t){
			return document.createTextNode(t);
		};
		return maak;
	})();
	
	var maakSudoku=function(){
		var rijPositie=function(index,j){return [index, j];};
		var kolomPositie=function(index, j){return [j, index];};
		var vakPositie=(function(){
				var pos=function(i){return [Math.floor(i/3),i%3];};
				return function(index,j){
					var vakPos=pos(index);
					var jPos=pos(j);
					return [
						3*vakPos[0]+jPos[0],
						3*vakPos[1]+jPos[1]
					];
				};
			})();
		var vak2Positie=function(index, j){
			var vakPos=[1+4*(Math.floor(index/2)),1+4*(index%2)];
			var jPos=[Math.floor(j/3),j%3];
			return [
				vakPos[0]+jPos[0],
				vakPos[1]+jPos[1]
			];
		};
		var vakIndex=function(r,k){
			var vakrij=Math.floor(r/3);
			var vakkolom=Math.floor(k/3);
			return 3*vakrij+vakkolom;
		};
		var vak2Index=function(r,k){
			if(r%4!=0&&k%4!=0){
				var switcher=function(t){if(t<4){return 0;}else{return 1;}};
				return 2*switcher(r)+switcher(k);
			}else{
				return -1;
			}
		};
		var volgendeCel=function(rij, kolom, hoever){
			var r,k;
			var volgende=function(){
				if(kolom<8){
					r=rij;
					k=kolom+1;
				}else{
					if(rij<8){
						r=rij+1;
						k=0;
					}else{
						r=0;
						k=0;
					}
				}
				rij=r;
				kolom=k;
			};
			volgende();
			if(hoever){for(var i=0;i<hoever-1;i++){volgende();}}
			return {rij:rij,kolom:kolom};
		};
		var leeg=function(){
			var g=[];
			for(var i=0;i<9;i++){g.push([0,0,0,0,0,0,0,0,0]);}
			return g;
		};
		var Permutatielijst=function(n){
			var nullen=function(){
				var l=[];
				for(var i=0;i<n;i++){l.push(0);}
				return l;
			};
			var klaar=false;
			var tak=(function(){
				var huidig=nullen();
				var gaVerder=function(){
					var p=n-1;
					while(p>=0){
						if(huidig[p]<n-1-p){
							huidig[p]++;
							return true;
						}else{
							huidig[p]=0;
							p--;
						}
					}
					return false;
				};
				var permutatie=(function(indexLijst){
					return function(){
						var p=nullen();
						var i, j, k, index;
						for(i=0;i<n;i++){
							k=-1;
							index=huidig[i];
							for(j=0;j<n;j++){
								if(p[j]==0){k++;}
								if(k==index){
									p[j]=indexLijst[i];
									break;
								}
							}
						}
						return p;
					};
				})((function(n){
					var oud=[];
					for(var i=0;i<n;i++){
						oud.push(i+1);
					}
					var nieuw=[];
					while(oud.length>0){
						nieuw.push(oud.splice(Math.floor(Math.random()*oud.length),1)[0]);
					}
					return nieuw;
				})(n));
				return {huidig:function(){return huidig;},gaVerder:gaVerder,permutatie:permutatie};

			})();
			var eerste=true;
			var volgende=function(){
				if(eerste){
					eerste=false;
					return tak.permutatie();
				}else{
					if(tak.gaVerder()){
						return tak.permutatie();
					}else{
						klaar=true;
						return null;
					}
				}
			};
			return {volgende:volgende,isKlaar:function(){return klaar;}};
		};
		var versie=function(getallen, andereToestand){
			var gi,g=[];
			
			for(var i=0;i<9;i++){
				gi=[];
				for(var j=0;j<9;j++){
					gi.push(getallen[i][j]);
				}
				g.push(gi);
			}
			var zet=function(rij, kolom, n){
				g[rij][kolom]=n;
			};
			var checkVerzameling=function(positie){
				return function(index, callbackFalse){
					var pos,hier,gehad=[0,0,0,0,0,0,0,0,0];
					for(var j=0;j<9;j++){
						pos=positie(index,j);
						hier=g[pos[0]][pos[1]];
						if(hier>0){
							if(gehad[hier-1]>0){if(callbackFalse){callbackFalse();}return false;}else{
								gehad[hier-1]++;
							}
						}
					}
					return true;
				};
			};
			var verzamelingenMetGetal=function(positie, aantalVerzamelingen){
				return function(n){
					var pos, v=[];
					for(var i=0;i<aantalVerzamelingen;i++){
						for(var j=0;j<9;j++){
							pos=positie(i,j);
							if(g[pos[0]][pos[1]]==n){
								v.push(i);
								break;
							}
						}
					}
					return v;
				};
			};
			var checkRij=checkVerzameling(rijPositie);
			var checkKolom=checkVerzameling(kolomPositie);
			var checkVak=checkVerzameling(vakPositie);
			var checkVak2=checkVerzameling(vak2Positie);
			var checkKolommen=function(){
				for(var i=0;i<9;i++){if(!checkKolom(i)){return false;}}
				return true;
			};
			var checkVakken=function(rijIndex){
				var vakRij=Math.floor(rijIndex/3);
				for(var i=0;i<3;i++){
					if(!checkVak(3*vakRij+i)){return false;}
				}
				return true;
			};
			var checkVakken2=function(rijIndex){
				if(rijIndex%4==0){return true;}else{
					if(rijIndex<4){return checkVak2(0)&&checkVak2(1);}else{return checkVak2(2)&&checkVak2(3);}
				}
			};
			var check=(function(t){
				if(t){
					return function(vanuitRij){
						return checkKolommen()&&checkVakken(vanuitRij)&&checkVakken2(vanuitRij);
					};
				}else{
					return function(vanuitRij){
						return checkKolommen()&&checkVakken(vanuitRij);
					};
				}
			})(andereToestand);
			var checkAlles=function(){
				return check(1)&&check(4)&&check(7);
			};
			var rijenMetGetal=verzamelingenMetGetal(rijPositie, 9);
			var kolommenMetGetal=verzamelingenMetGetal(kolomPositie, 9);
			var vakkenMetGetal=verzamelingenMetGetal(vakPositie, 9);
			var vakken2MetGetal=verzamelingenMetGetal(vak2Positie, 4);
			var getallenRij=function(){
				var arr1=[];
				for(var i=0;i<9;i++){
					arr1.push(g[i].join(''));
				}
				return arr1.join('');
			};
			return {
				getallen:function(){return g;},
				zet:function(rij, kolom, n){zet(rij, kolom, n);return this;},
				op: function(rij, kolom){return g[rij][kolom];},
				checkRij:checkRij,
				checkKolom:checkKolom,
				checkVak:checkVak,
				checkVak2:checkVak2,
				checkKolommen: checkKolommen,
				checkVakken:checkVakken,
				rijenMetGetal:rijenMetGetal,
				kolommenMetGetal:kolommenMetGetal,
				vakkenMetGetal:vakkenMetGetal,
				vakken2MetGetal:vakken2MetGetal,
				check:check,
				checkAlles:checkAlles,
				getallenRij:getallenRij
			};
		};
		var gegeven=versie(leeg());

		var vulIn=function(v, regularUpdate, callSuccess, callFailure){
			var go;
			var getallenOver=(function(getallen){
				var o=[];
				var allemaal=function(){return [1,2,3,4,5,6,7,8,9];};
				for(var i=0;i<9;i++){
					var oi=allemaal();
					var g=getallen[i];
					var index;
					for(var j=0;j<9;j++){
						if(g[j]!=0){
							index=oi.indexOf(g[j]);
							oi.splice(index,1);
						}
					}
					o.push(oi);
				}
				return o;
			})(v.getallen()); 

			var permutatoren=(function(over){
				var p=[];
				var vernieuw=[];
				for(var i=0;i<9;i++){
					vernieuw.push((function(index, size){
						return function(){
							p[index]=Permutatielijst(size);
						};
					})(i,over[i].length));
				}
				for(var i=0;i<9;i++){
					vernieuw[i]();
				}
				var zijnKlaar=function(){
					for(var i=0;i<9;i++){
						if(!p[i].isKlaar()){return false;}
					}
					return true;
				};
				return {vernieuw:vernieuw,item:function(i){return p[i];},zijnKlaar:zijnKlaar}
			})(getallenOver);

			var vulRij=(function(over, getallen){
				var vul=[];
				for(var i=0;i<9;i++){
					vul.push((function(index, over, getallen){
						var plekken=[];
						for(var i=0;i<9;i++){
							if(getallen[i]==0){plekken.push(i);}
						}
						return function(permutatie){
							for(var i=0;i<over.length;i++){
								v.zet(index, plekken[permutatie[i]-1], over[i]);
							}
						};

					})(i, over[i], getallen[i]));
				}
				return vul;
			})(getallenOver, v.getallen());

			var maakRijLeeg=(function(getallen){
				var maak=[];
				for(var i=0;i<9;i++){
					maak.push((function(index, getallen){
						var plekken=[];
						for(var i=0;i<9;i++){
							if(getallen[i]==0){plekken.push(i);}
						}
						return function(){
							for(var i=0;i<plekken.length;i++){
								v.zet(index, plekken[i], 0);
							}
						};
					})(i, getallen[i]));
				}
				return maak;
			})(v.getallen());


			var huidigeRij=0;
			var teller=0;
			var p;
			var doorgaan=function(){
				return huidigeRij>-1&&huidigeRij<9&&(!permutatoren.zijnKlaar());
			};
			var klaar=function(){
				if(huidigeRij==9){
					var doorstart=false;
					if(callSuccess){doorstart=callSuccess(v.getallen());}
					if(doorstart){
						huidigeRij--;
						go();
					}
				}else{
					if(callFailure){callFailure();}
				}
			};
			var doeStap=function(){
				if(p=permutatoren.item(huidigeRij).volgende()){
					vulRij[huidigeRij](p);
					if(v.check(huidigeRij)){
						huidigeRij++;
					}
				}else{
					maakRijLeeg[huidigeRij]();
					permutatoren.vernieuw[huidigeRij]();
					huidigeRij--;
				}
			};
			go=(function(callback){
				if(callback){
					return function(){
						teller=0;
						while(teller<200000&&doorgaan()){
							doeStap();
							teller++;
						}
						callback(v.getallen(), huidigeRij/8, "rij: "+huidigeRij);
						if(doorgaan()){setTimeout(go, 2);}else{
							klaar();
						}
					};
				}else{
					return function(){
						while(doorgaan()){
							doeStap();
						}
						klaar();
					};
				}
			})(regularUpdate);
			if(regularUpdate){console.log("updating");regularUpdate(v.getallen(), huidigeRij/8, "rij: "+huidigeRij);}
			go();
		};

		var random=function(reportBack, minN, finalCallback){
			var log=(function(){
				if(reportBack){
					return function(text){reportBack(0,0,text);};
				}else{
					return function(text){console.log("[random] "+text);}
				}
			})();
			log("begin");
			var v=versie(leeg());
			vulIn(v);
			var rij=0;
			var kolom=0;
			var over=81;
			var volgende;
			minN=minN?minN:28;
			var isUnique=function(v, returnBool){
				log("begin checking for uniqueness...(rij:"+rij+",kolom:"+kolom+")");
				var n=0;
				var result=true;
				vulIn(
						versie(v.getallen()),
						function(a,b,t){log(t);},
						function(d){
							n++;
							if(n==1){return true;}else{returnBool(false);return false;}
						},
						function(){if(n==1){returnBool(true);}}
					);
				//console.log("[random] done checking for uniqueness");
				//return result;
			};
			var naarVolgendeBewoonde=function(hoeveel){
				var volgende;
				var go=function(){
					do{
						volgende=volgendeCel(rij,kolom);
						rij=volgende.rij;
						kolom=volgende.kolom;
					}while(!v.op(rij,kolom));
				};
				go();
				if(hoeveel){for(var i=0;i<hoeveel-1;i++){go();}}
			};
			var slaOver=function(returnBool){
				var eerstRij=rij;
				var eerstKolom=kolom;
				var gezocht=false;
				timedOutWhile(
					function(returnBool0){
						isUnique(versie(v.getallen()).zet(rij, kolom, 0), function(b){returnBool0(!b);})
					},
					function(next){
						gezocht=true;
						log("overslaan")
						naarVolgendeBewoonde();
						next();
					},
					function(){
						if(gezocht&&rij==eerstRij&&kolom==eerstKolom){returnBool(false);return;}
						returnBool(true);
					}
					);
			};
			timedOutWhile(
				function(returnBool){
					if(over<=minN){returnBool(false);}else{
						slaOver(returnBool);
					}
				},
				function(next){
					v.zet(rij,kolom,0);
					over--;
					naarVolgendeBewoonde(1+Math.floor(Math.random()*2));
					next();
				},
				function(){
					log("klaar (over: "+over+")");
					if(finalCallback){finalCallback(v.getallen(), v.getallenRij());}
				}
			);
		};

		var hasher;

		return {
			zet: function(rij,kolom,n){gegeven.zet(rij,kolom,n);if(hasher){hasher.update(gegeven.getallenRij());}},
			setHasher: function(h){hasher=h;},
			getallen:gegeven.getallen,
			getallenRij: gegeven.getallenRij,
			versie: versie,
			vulIn: vulIn,
			leeg:leeg,
			rijPositie:rijPositie,
			kolomPositie:kolomPositie,
			vakPositie:vakPositie,
			vak2Positie:vak2Positie,
			volgendeCel: volgendeCel,
			vakIndex: vakIndex,
			vak2Index: vak2Index,
			random: random
		};
	};
	var sudoku=maakSudoku();

	var editor=(function(){
		var editor=document.createElement('div');
		var littleThing;
		var form;
		editor.setAttribute('style', 'width:450px;height:450px;position:relative');
		var form2=makeNode('<div id="1" style="width:450px;height:450px;position:relative"><table style="position:absolute;left:0px;top:0px;width:100%;height:100%;margin:0px;padding:0px;border-spacing:0px;color:inherit" offspring="$(backgroundRows)"></table><svg xmlns="http://www.w3.org/2000/svg" id="2" style="position:absolute;left:0px;top:0px;width:100%;height:100%"></svg><table style="position:absolute;left:0px;top:0px;width:100%;height:100%;margin:0px;padding:0px;border-spacing:0px;color:inherit" offspring="$(rows)"></table></div>',
			function(node, middleSvg){
				var middle=(function(){
					var style='fill:transparent;stroke-width:1;stroke:#999999';
					var drawSquare=function(left, top, side){
						middleSvg.appendChild((function(){
							var el=document.createElementNS("http://www.w3.org/2000/svg", 'rect');
							el.setAttribute('width',side);
							el.setAttribute('height',side);
							el.setAttribute('x', left);
							el.setAttribute('y',top);
							el.setAttribute('style',style);
							return el;
						})());
					};
					var drawLine=function(x1,y1,x2,y2){
						middleSvg.appendChild((function(){
							var el=document.createElementNS("http://www.w3.org/2000/svg", 'line');
							el.setAttribute('x1', x1);
							el.setAttribute('y1', y1);
							el.setAttribute('x2', x2);
							el.setAttribute('y2', y2);
							el.setAttribute('style',style);
							return el;
						})());
					};
					var drawCircle=function(left, top, radius){
						middleSvg.appendChild((function(){
							var el=document.createElementNS("http://www.w3.org/2000/svg", 'circle');
							el.setAttribute('cx', left);
							el.setAttribute('cy',top);
							el.setAttribute('r',radius);
							el.setAttribute('style',style);
							return el;
						})());
					};
					var drawCubic=function(x1,y1,cx1,cy1,cx2,cy2,x2,y2){
						middleSvg.appendChild((function(){
							var el=document.createElementNS("http://www.w3.org/2000/svg", 'path');
							el.setAttribute('d', 'M'+x1+' '+y1+' C '+cx1+' '+cy1+', '+cx2+' '+cy2+', '+x2+' '+y2);
							el.setAttribute('style',style);
							return el;
						})());
					};
					var connect=function(r1,c1,r2,c2){
						var r=20;
						var d=function(i){return 50*i+25;};
						var x1=d(c1),x2=d(c2),y1=d(r1),y2=d(r2);
						var d=Math.sqrt(Math.pow(x1-x2, 2)+Math.pow(y1-y2, 2));
						var angle=Math.PI/9;
						var dx=(x2-x1)/d,dy=(y2-y1)/d;
						var ex1=x1+r*(dx*Math.cos(angle)-dy*Math.sin(angle)), ey1=y1+r*(dy*Math.cos(angle)+dx*Math.sin(angle));
						var cx1=x1+(r+(d-2*r)/4)*(dx*Math.cos(angle)-dy*Math.sin(angle)), cy1=y1+(r+(d-2*r)/4)*(dy*Math.cos(angle)+dx*Math.sin(angle));
						var ex2=x2+r*(-dx*Math.cos(angle)-dy*Math.sin(angle)), ey2=y2+r*(-dy*Math.cos(angle)+dx*Math.sin(angle));
						var cx2=x2+(r+(d-2*r)/4)*(-dx*Math.cos(angle)-dy*Math.sin(angle)), cy2=y2+(r+(d-2*r)/4)*(-dy*Math.cos(angle)+dx*Math.sin(angle));
						drawCircle(x1,y1,r);
						drawCircle(x2,y2,r);
						drawCubic(ex1,ey1,cx1,cy1,cx2,cy2,ex2,ey2);
					};
					var clear=function(){
						middleSvg.innerHTML="";
					};
					return {
						drawSquare:drawSquare,
						connect:connect,
						clear:clear
					};
				})();
				var highlighting,otherState=false,shading=false;
				var self=this;
				var allCells=function(f){
					return self.cells.map(function(r){return r.map(f);})[0][0];
				};
				var makeRedSet=function(posF){
					var position=function(index){return function(j){return posF(index, j);};};
					return function(i, color){
						var p, pos=position(i);
						for(var j=0;j<9;j++){
							p=pos(j);
							self.cells[p[0]][p[1]].makeRed(color);
						}
					};
				};
				var eliminateFromSet=function(posF){
					var position=function(index){return function(j){return posF(index, j);};};
					return function(i, n){
						var p, pos=position(i);
						for(var j=0;j<9;j++){
							p=pos(j);
							self.cells[p[0]][p[1]].eliminate(n);
						}
					};
				};
				var toggleHighlighting=function(){
					allCells(function(c){c.toggleHighlighting();});
				};
				var getTwinsInSets=(function(){
					var arrayEquals=function(arr1, arr2){
						if(!arr1||!arr2){return false;}
						if(arr1.length!=arr2.length){return false;}
						for(var i=0;i<arr1.length;i++){
							if(arr1[i]!=arr2[i]){return false;}
						}
						return true;
					};
					var twinSet=function(){
						var t=[];
						var has=function(twin){
							for(var i=0;i<t.length;i++){
								if(arrayEquals(t[i][0], twin[0])){return true;}
							}
							return false;
						};
						return {
							push:function(twin){if(!has(twin)){t.push(twin);}},
							any: function(){return t.length>0;},
							set: function(){return t;}
						};
					};
					return function(posF, numberOfSets){
						return function(){
							var p, p1,p2,poss, allTwins, twins, waarZit, getallen;
							allTwins=[];
							for(var k=0;k<numberOfSets;k++){
								twins=twinSet();
								waarZit=[[],[],[],[],[],[],[],[],[]];
								getallen=sudoku.getallen();
								for(var i=0;i<9;i++){
									p=posF(k,i);
									if(!getallen[p[0]][p[1]]){
										poss=self.cells[p[0]][p[1]].getPossibilities();
										for(var j=0;j<poss.length;j++){
											waarZit[poss[j]-1].push(i);
										}
									}
								}

								//see if there are two numbers that only occur in two places
								for(var i=0;i<9;i++){
									for(var j=i+1;j<9;j++){
										if(waarZit[i].length==2&&arrayEquals(waarZit[i], waarZit[j])){
											twins.push([[i+1,j+1],[posF(k, waarZit[i][0]), posF(k, waarZit[i][1])]]);
										}
									}
								}

								//see if there are two places that have the same 2 possibilities
								for(var i=0;i<9;i++){
									for(var j=i+1;j<9;j++){
										p1=posF(k, i);
										p2=posF(k,j);
										poss=self.cells[p1[0]][p1[1]].getPossibilities();
										if(poss&&poss.length==2&&arrayEquals(poss, self.cells[p2[0]][p2[1]].getPossibilities())){
											twins.push([poss,[p1,p2]]);
										}
									}
								}
								if(twins.any()){allTwins.push(twins.set())};
							}
							return allTwins;
						};
					};
				})();
				var showTwinsInSets=function(){
					console.log("showTwinsInSets");
					if(shading){
						middle.clear();
						//allCells(function(c){c.shade('transparent');});
						var p1,p2;
						var twins=getTwinsInSets(sudoku.vakPositie, 9)().concat(getTwinsInSets(sudoku.rijPositie, 9)()).concat(getTwinsInSets(sudoku.kolomPositie, 9)());
						if(otherState){twins=twins.concat(getTwinsInSets(sudoku.vak2Positie, 4)());}
						for(var i=0;i<twins.length;i++){
							for(var j=0;j<twins[i].length;j++){
								p1=twins[i][j][1][0];
								p2=twins[i][j][1][1];
								middle.connect(p1[0],p1[1],p2[0],p2[1]);
								//self.cells[p1[0]][p1[1]].shade("rgba(85,85,187,0.1)");
								//self.cells[p2[0]][p2[1]].shade("rgba(85,85,187,0.1)");
							}
						}
					}
				};
				var toggleShadingView=function(){
					shading=!shading;
					if(shading){showTwinsInSets()}else{middle.clear();}
				};
				var togglePossibilitiesView=function(){
					allCells(function(c){c.togglePossibilitiesView();});
				};
				var makeNotRed=function(){
					allCells(function(c){c.makeNotRed();});
				};
				var resetPossibilities=function(){
					allCells(function(c){c.reset();});
				};
				var toggleKind=function(){
					otherState=allCells(function(c){return c.toggleOtherState();});
					if(hash){hash.update();}
				};
				var setAll=function(numbers){
					resetPossibilities();
					var n;
					for(var i=0;i<9;i++){
						for(var j=0;j<9;j++){
							n=numbers[i][j]||0;
							self.cells[i][j].setValue(n==0?'':n, true);
							sudoku.zet(i, j, n);
						}
					}
					showTwinsInSets();
				};
				var setAllFromString=function(a){
					a=a.replace(/[\D]/g, "");
					var g=sudoku.versie(sudoku.leeg());
					for(var i=0;i<a.length&&i<81;i++){
						g.zet(Math.floor(i/9),i%9,parseInt(a[i]));
					}
					if(otherState){toggleKind();}
					setAll(g.getallen());
				};
				var filler=(function(){
					var r=0;
					var k=0;
					var going=false;
					var go=function(){
						self.cells[r][k].fillRemainingPossibility();
						var next=sudoku.volgendeCel(r,k);
						r=next.rij;
						k=next.kolom;
						if(going){setTimeout(go, 20);}
					};
					var stop=function(){going=false;};
					return {go:function(){going=true;go();},stop:stop}
				})();
				var r={
					middle:middle,
					toggleHighlighting:toggleHighlighting,
					toggleShadingView:toggleShadingView,
					makeRedRow: makeRedSet(sudoku.rijPositie),
					makeRedColumn: makeRedSet(sudoku.kolomPositie),
					makeRedSquare: makeRedSet(sudoku.vakPositie),
					makeRedSquare2: makeRedSet(sudoku.vak2Positie),
					eliminateFromRow: eliminateFromSet(sudoku.rijPositie),
					eliminateFromColumn: eliminateFromSet(sudoku.kolomPositie),
					eliminateFromSquare: eliminateFromSet(sudoku.vakPositie),
					eliminateFromSquare2: eliminateFromSet(sudoku.vak2Positie),
					startFilling: function(){filler.go();},
					stopFilling: function(){filler.stop();},
					makeNotRed:makeNotRed,
					resetPossibilities:resetPossibilities,
					toggleKind:toggleKind,
					togglePossibilitiesView:togglePossibilitiesView,
					showTwinsInSets:showTwinsInSets,
					setAll:setAll,
					setAllFromString:setAllFromString,
					otherState:function(){return otherState;}
				};
				console.log(r);
				editor.appendChild(node);
				return r;
			},
			[9,function(rowIndex, getToReturn){
				var self=this;
				var cells=function(){return self.cells;};
				var background=function(row,column){
					return self.backgroundCells[row][column];
				};
				var row=makeNode('<tr id="1" style="margin:0px;padding:0px;border-spacing:0px" offspring="$(tds)"></tr>',
					function(tr){
						return {
							tr:tr,
							cells:this.cells,
						};
					},
					[9,function(columnIndex){
						var cell=makeNode('<td id="1" style="margin:0px;padding:0px;border-spacing:0px"><div id="2" style="position:relative;width:100%;height:100%;" align="center"><div id="3" style="position:absolute;left:0px;top:0px;width:100%;height:100%;background-color:transparent;border-radius:50%"></div><input id="4" type="text" maxlength="1" style="text-align:center;border:0px;width:50%;font-size:20px;position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);background-color:transparent" /><div style="position:absolute;left:0px;top:0px;width:100%;height:'+(rowIndex==0?3:0)+'px;background-color:#000"></div><div style="position:absolute;right:0px;top:0px;width:'+(columnIndex==8?3:0)+'px;height:100%;background-color:#000"></div><div style="position:absolute;left:0px;bottom:0px;width:100%;height:'+((rowIndex==8||rowIndex%3==2)?3:1)+'px;background-color:#000"></div><div style="position:absolute;left:0px;top:0px;width:'+((columnIndex==0||columnIndex%3==0)?3:1)+'px;height:100%;background-color:#000"></div><div id="5" style="position:absolute;left:'+((columnIndex==0||columnIndex%3==0)?3:1)+'px;top:'+(rowIndex==0?3:0)+'px;font-family:Arial;color:#999999;font-size:8px"></div></div></td>',
							function(td, div, sh, input, possNode){
								var otherState=false;
								var highlighting=false;
								var shading=false;
								var vakIndex=sudoku.vakIndex(rowIndex, columnIndex);
								var vak2Index=sudoku.vak2Index(rowIndex, columnIndex);
								var initialColor="#fff";
								var possibilities=(function(){
									var hidden=false;
									var showingPossibilities=false;
									var p=[1,2,3,4,5,6,7,8,9];
									var toString=function(){return p.join('');};
									var display=function(){if(!hidden&&showingPossibilities){possNode.innerHTML=toString();}};
									var eliminate=function(n){
										if(n){
											var i=p.indexOf(n);
											if(i>-1){
												p.splice(i,1);
												display();
											}
										}
									};
									var hide=function(){possNode.innerHTML='';hidden=true;};
									var reset=function(){hidden=false;p=[1,2,3,4,5,6,7,8,9];display();};
									var get=function(){return (!hidden)?p:null;};
									var toggleView=function(){
										showingPossibilities=!showingPossibilities;
										if(showingPossibilities){display();}else{possNode.innerHTML='';}
									};
									display();
									return {eliminate:eliminate,toString:toString,reset:reset,hide:hide,get:get, toggleView:toggleView};
								})();
								var shade=function(color){
									if(shading){sh.style.backgroundColor=color}else{
										sh.style.backgroundColor="transparent";
									}
								};
								var makeRed=function(color){
									background(rowIndex,columnIndex).style.backgroundColor=color?color:"#FF0000";
								};
								var makeNotRed=function(){
									background(rowIndex,columnIndex).style.backgroundColor=initialColor;
								};
								var highlightImpossibles=function(){
									var v=input.value;
									var p;
									if(highlighting&&v){
										v=parseInt(v);
										cells().map(function(r){r.map(function(c){
											p=c.getPossibilities();
											if(p==null||p.indexOf(v)==-1){
												c.makeRed("#BB5555");
											}
										});});
									}
								};
								var toggleInitialColor=(function(ind){
									var on=false;
									return function(){
										if(on){
											initialColor="#FFFFFF";
											makeNotRed();
											on=false;
										}else{
											initialColor=ind==-1?"#FFFFFF":"#BBBBBB";
											makeRed(initialColor);
											on=true;
										}
									};
								})(vak2Index);
								var setValue=function(v, commit){
									input.value=v;
									if(commit){commitValue(v);}	
								};
								var hidePossibilities=function(){possibilities.hide();};
								var commitValue=function(v){
									var form=getToReturn();
									if(v){

										form.eliminateFromRow(rowIndex, v);
										form.eliminateFromColumn(columnIndex, v);
										form.eliminateFromSquare(vakIndex, v);
										if(otherState&&vak2Index>-1){form.eliminateFromSquare2(vak2Index, v);}
										hidePossibilities();
									}
								};
								var hasValue=function(){return input.value!="";};
								var fillRemainingPossibility=(function(){
									return function(){
										var pos=possibilities.get();
										if((!input.value)&&pos.length==1){
											console.log("filling");
											var toSet=pos[0];
											setValue(toSet, true);
											sudoku.zet(rowIndex, columnIndex, toSet);
											moves.make(rowIndex, columnIndex, toSet);
										}
									};
								})();
								var ignore=false;
								input.onfocus=highlightImpossibles;
								input.onkeyup=function(){
									var v=input.value;
									var form=getToReturn();
									if(v!=""&&v.match(/[1-9]/g)==null){
										makeRed();
										ignore=true;
									}else{
										form.makeNotRed();
										if(v!=""){
											var n=parseInt(v);
											var versie=sudoku.versie(sudoku.getallen()).zet(rowIndex, columnIndex, n);
											var check=versie.checkKolom(columnIndex, function(){ignore=true;form.makeRedColumn(columnIndex);})&&versie.checkRij(rowIndex, function(){ignore=true;form.makeRedRow(rowIndex);})&&versie.checkVak(vakIndex, function(){ignore=true;form.makeRedSquare(vakIndex);})&&((otherState&&vak2Index!=-1)?versie.checkVak2(vak2Index, function(){ignore=true;form.makeRedSquare2(vak2Index);}):true);
											if(check){
												sudoku.zet(rowIndex, columnIndex, n);
												setValue(n, true);
												ignore=false;
												moves.make(rowIndex, columnIndex, n);
												highlightImpossibles();
											}
										}else{
											sudoku.zet(rowIndex, columnIndex, 0);
											form.setAll(sudoku.getallen());
										}
									}
								};
								input.onblur=function(){
									var form=getToReturn();
									if(ignore){
										setValue("");
									}
									form.makeNotRed();
								}
								return {
									td:td,
									cell:{
										shade:shade,
										makeRed: makeRed,
										makeNotRed:makeNotRed,
										setValue:setValue,
										toggleInitialColor:toggleInitialColor,
										eliminate:possibilities.eliminate,
										reset:possibilities.reset,
										getPossibilities:possibilities.get,
										fillRemainingPossibility:fillRemainingPossibility,
										hasValue:hasValue,
										togglePossibilitiesView:possibilities.toggleView,
										toggleHighlighting:function(){highlighting=!highlighting;return highlighting;},
										toggleShading: function(){shading=!shading;return shading;},
										toggleOtherState: function(){otherState=!otherState;toggleInitialColor();return otherState;}
									}
								};
							});
						return {
							tds:cell.td,
							cells:cell.cell,
						};
					}]);
				var backgroundRow=makeNode('<tr id="1" style="margin:0px;padding:0px;border-spacing:0px" offspring="$(tds)"></tr>',
					function(tr){
						return {
							tr:tr,
							cells:this.cells
						};
					},
					[9,function(){
						var cell=makeNode('<td style="margin:0px;padding:0px;border-spacing:0px" id="1"><div id="2" style="width:100%;height:100%"></div></td>',
							function(td, div){
								return {
									td:td,
									cell:div
								};
							});
						return {
							tds:cell.td,
							cells:cell.cell
						};
					}]);
				return {
					rows:row.tr,
					backgroundRows: backgroundRow.tr,
					cells:row.cells,
					backgroundCells: backgroundRow.cells
				};
			}]
			);

		form=form2;
		var panel=makeNode('<div id="1" align="center" style="position:absolute;left:0px;bottom:0px;background-color:rgb(0,0,0);border:3pt solid #000"></div>',function(node){
				var showing="controls",initialSize=7;
				node.style.width=(initialSize)+"px";
				node.style.height=initialSize+"px";
				var setProgressBar=makeNode('<div id="1" style="width:450px;height:450px;position:relative" align="left"><div id="2" style="position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);background-color:#000;height:50px;width:50%"></div></div>',
					function(node0, bar){
						return function(p){
							if(showing=="controls"){
								node.removeChild(controls);
								node.appendChild(node0);
								showing="bar";
							}
							bar.style.width=(p*100)+"%";
							if(p==-1){
								if(showing=="bar"){
									node.removeChild(node0);
									node.appendChild(controls);
									showing="controls";
								}
							}
						};
					}
					);
				var prompt=makeNode('<div id="1" style="width:450px;height:450px;position:absolute;left:0px;top:0px" align="center"><div style="position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);width:400px;height:300px;border:1pt solid #000;background-color:#fff"><table style="width:100%;height:100%"><tr style="height:40%"><td><a id="3" style="font-family:Verdana;font-size:12px"></a></td></tr><tr style="height:30%"><td><input id="4" type="text" style="width:80%"/></td></tr><tr style="height:30%"><td><input id="2" type="button" value="Cancel" /><input id="5" type="button" value="OK" /></td></tr></table></div></div>',
					function(win, cancelButton, questionText, input, okButton){
						cancelButton.onclick=function(){node.removeChild(win);};
						return function(question,answer){
							node.appendChild(win);
							questionText.innerHTML=question;
							okButton.onclick=function(e){e.preventDefault();e.stopPropagation();node.removeChild(win);answer(input.value);};
						};
					});
				var setText=makeNode('<div id="1" style="width:450px;height:450px;position:relative"><textarea id="2" style="width:400px;height:400px;position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);font-family:Verdana;font-size:10px;color:#000"></textarea></div>',
					function(layover, input){
						return function(text, color){
							if(showing=="controls"){
								node.removeChild(controls);
								node.appendChild(layover);
								showing="text";
								input.value="";
							}
							input.value+=text+"\n";
							input.scrollTop=input.scrollHeight;
							input.style.color=color?color:"#000";
							node.onclick=function(){console.log("removing text");node.removeChild(layover);node.appendChild(controls);showing="controls";node.onclick=function(){};};
						};
					});
				var historyPanel=makeNode('<div id="1" style="width:450px;height:450px;position:absolute;left:0px;top:0px"><div id="2" style="width:400px;height:400px;position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);background-color:#fff;border:1pt solid #000"><table style="width:100%;height:100%"><tr style="height:80%"><td><div id="4" style="width:100%;height:100%;border:1pt solid #aaa;overflow:scroll"></div></td></tr><tr style="height:20%"><td><input id="3" type="button" value="Cancel"/><input id="5" type="button" value="OK"/><input id="6" type="button" value="rename"/></td></tr></table></div></div>',
					function(div, win, cancelButton, list, okButton, renameButton){
						cancelButton.onclick=function(){node.removeChild(div);};
						var show=function(){
							node.appendChild(div);
							var selected=-1;
							var select;
							list.innerHTML="";
							var listItems=history.getStates().map(function(state, index){
								var row=makeNode('<div id="1" style="width:100%;font-family:Verdana;font-size:15px">'+state.name+'</div>',
									function(itemDiv){
										list.appendChild(itemDiv);
										itemDiv.onclick=function(){select(index);};
										var setPresent=function(){
											itemDiv.style.backgroundColor='#bbb';
											itemDiv.style.color='#000';
										};
										var setPast=function(){
											itemDiv.style.backgroundColor='#fff';
											itemDiv.style.color='#000';
										};
										var setFuture=function(){
											itemDiv.style.backgroundColor='#fff';
											itemDiv.style.color='#555';
										};
										var rename=function(newName){
											itemDiv.innerHTML=newName;
										};
										return {setPresent:setPresent,setPast:setPast,setFuture:setFuture,rename:rename};
									});
								return row;
							});
							select=function(index){
								listItems.map(function(item,i){
									if(i<index){item.setPast();}
									if(i==index){item.setPresent();}
									if(i>index){item.setFuture();}
								});
								selected=index;
							};
							okButton.onclick=function(){
								if(selected!=-1){
									history.setState(selected);
								}
								node.removeChild(div);
							};
							renameButton.onclick=function(){
								if(selected!=-1){
									prompt('new name:',function(a){
										listItems[selected].rename(a);
										history.renameState(selected,a);
									})
								}
							};
						};
						return {show:show};
					});
				var controls=makeNode('<div style="position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%)"><table style="width:100%"><tr><td align="right" style="width:50%" offspring="$(buttons)"></td><td align="left" style="width:50%"><div style="border:1pt solid #000;width:150px">$(checkBoxes)</div></td></tr></table></div>',
					null,
					(function(){
						var buttonTemplate='<div id="1" class="sudoku-button" align="center"><div style="position:relative;top:50%;transform:translateY(-50%)">$(text)</div></div>';
						var checkBoxTemplate='<div id="2" class="sudoku-switch"><table style="width:100%;height:100%;margin:0px;padding:0px;border-spacing:0px;color:inherit;font-family:inherit;font-size:inherit;font-weight:inherit"><tr><td style="padding:5px">$(text)</td><td style="width:20px"><input style="border:3pt solid #000" type="checkbox" id="1"/></td></tr></table></div>';
						var button=function(text, action){
							return makeNode(
										buttonTemplate,
										function(button){
											button.onclick=function(e){e.stopPropagation();action();};
										},
										{text:text}
									);
						};
						var checkBox=function(text, action, initialChecked){
							return makeNode(
										checkBoxTemplate,
										function(checkbox, div){
											var turnOn=function(){
												div.style.backgroundColor='#ddd';
												
												checkbox.setAttribute('checked','true');
												initialChecked=true;
											};
											var turnOff=function(){
												div.style.backgroundColor='#fff';
												
												checkbox.removeAttribute('checked');
												initialChecked=false;
											};
											if(initialChecked){turnOn();}
											div.onclick=function(e){
												e.stopPropagation();
												if(initialChecked){
													turnOff();
												}else{
													turnOn();
												}
												action(initialChecked, turnOn, turnOff);
											};
											checkbox.onclick=function(e){
												e.preventDefault();
												if(checkbox.checked&&!initialChecked){
													checkbox.removeAttribute('checked');
												}else if(!checkbox.checked&&initialChecked){
													checkbox.setAttribute('checked','true');
												}
											};
										},
										{text:text}
									);
						};
						var buttons=[
							["history",function(){history.saveCurrentState();historyPanel.show();}],
							['name',function(){prompt('what is your name?',
								function(a){
									form.setAllFromString(a);
								}
								);
							}],
							['GO', function(){
								setProgressBar(0);
								form.stopFilling();
								var getallen=sudoku.versie(sudoku.getallen()).getallen();
								sudoku.vulIn(
									sudoku.versie(sudoku.getallen(), form.otherState()),
									function(d, p){form.setAll(d);setProgressBar(Math.max(0, Math.min(p,1)));},
									function(){setProgressBar(-1);return false;},
									function(){form.setAll(getallen);setProgressBar(-1);setText("geen oplossing!", "rgb(150,0,0)");}
									);
							}],
							['Clear', function(){form.setAll(sudoku.leeg());}],
							['Undo', function(){if(moves){moves.back();}}],
							['random',function(){
								if(!form.otherState()){
									sudoku.random(
										function(a,b,t){setText(t);},
										null,
										function(getallen, rij){form.setAll(getallen);hash.update(rij);}
										);
								}
							}],
							['?', function(){
								var n=0;
								var klaar=function(){
									if(n!=0){setText(n==1?"eenduidig":"niet eenduidig", n==1?"rgb(0,150,0)":"rgb(200,150,0)");}
								};
								sudoku.vulIn(
									sudoku.versie(sudoku.getallen(), form.otherState()),
									function(d,p){setProgressBar(Math.max(0, Math.min(p,1)));},
									function(d){
										n++;
										if(n==1){
											return true;
										}else{
											setProgressBar(-1);
											setText("niet eenduidig", "rgb(200,150,0)");
											return false;
										}
									},
									function(){
										setProgressBar(-1);
										if(n==0){
											setText("geen oplossing!", "rgb(150,0,0)");
										}else{
											setText("eenduidig", "rgb(0,150,0)");
										}
									}
									);
							}],
							['serialize',function(){setText(sudoku.versie(sudoku.getallen()).getallenRij());}]
						];
						var checkBoxes=[
							['andere', function(checked, turnOn, turnOff){
								if(checked){
									var check=sudoku.versie(sudoku.getallen(), true).checkAlles();
									console.log(check);
									if(check){
										form.toggleKind();
									}else{
										turnOff();
									}
								}else{
									form.toggleKind();
								}
							}],
							['mogelijkheden', function(){form.togglePossibilitiesView();}],
							['autofill', (function(){
								var filling=false;
								return function(){
									if(!filling){
										filling=true;
										form.startFilling();
									}else{
										form.stopFilling();
										filling=false;
									}
								};
							})()],
							['highlight', function(){form.toggleHighlighting();}],
							['twins', function(){form.toggleShadingView();}]

						];
						return {
							buttons: buttons.map(function(b){return button(b[0], b[1]);}),
							checkBoxes: checkBoxes.map(function(c){return checkBox(c[0],c[1],c[2]);})
						};
					})()
					);
				
				var changeSizeTo=(function(initial, node){
					var s=initial;
					var g;
					var d, d0;
					var callback;
					var setSize=function(){
						node.style.width=(s)+"px";
						node.style.height=s+"px";
					};
					var makeStep=function(){
						s=s+(g-s)/2;
						d=d/2;
						setSize();
						if(d>d0/100){
							setTimeout(makeStep, 20);
						}else{
							s=g;
							setSize();
							callback();
						}
					};
					return function(g_, callback_){
						g=g_;
						d=Math.abs(s-g_);
						d0=d;
						callback=callback_||function(){};
						makeStep();
					};
				})(initialSize, node);
				var closeButton=makeNode('<div id="1" style="position:absolute;cursor:pointer;right:4px;top:4px;background-color:rgb(0,0,0);width:12px;height:12px"></div>',
					function(node){
						node.onclick=function(e){hide(e);};
					});
				var show=function(){
					node.style.backgroundColor="rgba(255,255,255,0.75)";
					changeSizeTo(442, function(){
						node.appendChild(controls);
						node.appendChild(closeButton);
						node.onclick=function(){};
					});
				};
				var hide=function(e){
					e.preventDefault();
					e.stopPropagation();
					node.removeChild(controls);
					node.removeChild(closeButton);
					changeSizeTo(initialSize, function(){
						node.style.backgroundColor="rgb(0,0,0)";
						node.onclick=show;
					});
				};
				node.onclick=show;
				editor.appendChild(node);
				return {show:show,hide:hide, setText:setText};
			}
			);
		b.appendChild(editor);
		return {setAll:form.setAll,setAllFromString:form.setAllFromString,otherState:form.otherState,toggleKind:form.toggleKind,startFilling:form.startFilling, stopFilling: form.stopFilling,showTwinsInSets: form.showTwinsInSets,getTwinsInRows:form.getTwinsInRows, getTwinsInColumns: form.getTwinsInColumns, display:panel.setText};
	})();
	var hash=(function(){
		var update=function(getallenRij){
			setHash((editor.otherState()?"1_":"0_")+getallenRij);
		};
		var process=function(){
			var h=getHash();
			if(h){
				if(h[0]==="1"){editor.toggleKind();}
				h=h.substr(2);
				var getallen=[];
				for(var i=0;i<9;i++){
					getallen.push((function(row){
						var r=[];
						for(var i=0;i<9;i++){
							r.push(parseInt(row[i]));
						}
						return r;
					})(h.substr(i*9,9)));
				}
				if(!sudoku.versie(getallen).checkAlles()){return false;}
				editor.setAll(getallen);
				return true;
			}
			return false;
		};
		return {update:update,process:process};
	})();
	sudoku.setHasher(hash);
	var list=(function(){
		var l=[
			[[0,7,0,0,0,5,0,0,0],[5,0,0,7,2,0,0,9,0],[8,0,0,0,0,0,0,0,0],[0,2,5,0,0,4,0,0,0],[0,0,6,3,7,1,5,0,0],[0,0,0,5,0,0,6,7,0],[0,0,0,0,0,0,0,0,2],[0,5,0,0,6,8,0,0,3],[0,0,0,9,0,0,0,1,0]],
			[[0,2,0,0,4,8,0,5,3],[0,0,0,3,0,0,0,6,0],[0,0,3,0,0,6,1,0,0],[1,0,0,0,0,0,0,0,0],[0,8,0,5,0,7,0,2,0],[0,0,0,0,0,0,0,0,1],[0,0,9,6,0,0,8,0,0],[0,3,0,0,0,5,0,0,0],[7,5,0,8,9,0,0,4,0]],
			[[0,1,0,0,0,0,0,0,0],[4,0,0,0,8,7,0,5,0],[0,7,0,0,0,3,6,0,0],[6,0,0,2,0,0,8,0,0],[0,4,2,0,0,0,7,3,0],[0,0,9,0,0,4,0,0,2],[0,0,8,9,0,0,0,7,0],[0,6,0,7,1,0,0,0,8],[0,0,0,0,0,0,0,2,0]],
			[[0,0,7,0,1,0,0,2,0],[6,0,8,0,0,3,0,0,0],[5,0,0,9,0,0,0,4,8],[0,0,0,0,0,8,0,0,6],[0,0,4,0,0,0,5,0,0],[1,0,0,5,0,0,0,0,0],[9,5,0,0,0,7,0,0,4],[0,0,0,6,0,0,7,0,3],[0,4,0,0,8,0,9,0,0]],
			[[0,0,0,0,8,0,7,0,2],[0,5,0,0,1,0,3,0,0],[0,2,0,3,0,0,0,8,0],[0,0,0,0,0,0,1,9,5],[0,4,0,0,0,0,0,3,0],[5,1,9,0,0,0,0,0,0],[0,8,0,0,0,2,0,4,0],[0,0,2,0,7,0,0,5,0],[3,0,1,0,9,0,0,0,0]],
			[[0,0,0,0,0,0,0,9,7],[0,0,0,8,0,0,1,0,0],[0,0,0,0,0,1,0,6,2],[0,4,0,0,7,0,3,0,1],[0,0,5,0,4,0,7,0,0],[2,0,6,0,3,0,0,5,0],[8,5,0,3,0,0,0,0,0],[0,0,1,0,0,2,0,0,0],[7,9,0,0,0,0,0,0,0]],
			[[0,7,6,0,0,0,0,0,0],[8,0,5,0,7,1,0,0,0],[3,0,0,0,9,0,0,0,0],[0,0,9,0,0,0,0,3,7],[0,8,0,3,0,2,0,4,0],[6,5,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,0,3],[0,0,0,5,2,0,4,0,1],[0,0,0,0,0,0,9,6,0]],
			[[6,0,1,3,0,4,0,0,0],[3,4,0,0,0,5,1,0,0],[0,0,0,0,0,7,0,0,0],[2,0,0,0,5,8,0,0,0],[0,0,8,0,0,0,4,0,0],[0,0,0,7,6,0,0,0,9],[0,0,0,5,0,0,0,0,0],[0,0,9,8,0,0,0,2,7],[0,0,0,2,0,6,3,0,5]],
			[[7,0,0,0,0,0,0,5,2],[0,0,0,7,4,0,0,0,0],[2,0,0,0,0,8,9,0,0],[0,0,7,0,0,4,0,3,0],[0,6,0,0,2,0,0,1,0],[0,8,0,3,0,0,7,0,0],[0,0,4,6,0,0,0,0,1],[0,0,0,0,7,3,0,0,0],[8,9,0,0,0,0,0,0,6]]
		];
		var setRandom=function(){
			editor.setAll(l[Math.floor(Math.random()*l.length)]);
		};
		return {setRandom:setRandom};
	})();
	var moves=(function(){
		var list=[];
		var make=function(r, c, n){
			list.push({r:r,c:c,n:n});
			editor.showTwinsInSets();
		};
		var back=function(){
			if(list.length>0){
				var move=list.splice(list.length-1,1)[0];
				sudoku.zet(move.r, move.c, 0);
				editor.setAll(sudoku.getallen());
				if(list.length>0){
					return true;
				}
			}
			return false;
		};
		return {make:make,back:back}
	})();
	var history=(function(){
		var states=[];
		var addState=function(name, state){
			states.push({name:name,state:state});
		};
		var saveCurrentState=function(name){
			var currentState=sudoku.versie(sudoku.getallen()).getallenRij();
			if(states.length==0||currentState!=states[states.length-1].state){
				addState(name?name:states.length.toString(), currentState);
			}
		};
		var getStates=function(){return states;};
		var setState=function(i){
			if(i<states.length){
				editor.setAllFromString(states[i].state);
				states=states.slice(0,i+1);
			}
		};
		var renameState=function(i, newName){
			if(i<states.length){
				states[i].name=newName;
			}
		};
		return {
			saveCurrentState:saveCurrentState,
			getStates:getStates,
			setState:setState,
			renameState:renameState
		};
	})();
	if(!hash.process()){editor.setAll(sudoku.versie(sudoku.leeg()).getallen());hash.update(sudoku.getallenRij());}
	window.sudoku=sudoku;
	window.editor=editor;
})(document.body, function(h){window.location.hash=h;}, function(){return window.location.hash.substr(1);});
</script>
</html>
