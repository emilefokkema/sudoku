<html>
<head>
<title>Sudoku</title>
<meta name="viewport" content="width=475,user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="mobile-web-app-capable" content="yes" />
</head>
<body></body>
<script language="JavaScript">
(function(b, setHash, getHash){
	var sudoku=(function(){
		var rijPositie=function(index,j){return [index, j];};
		var kolomPositie=function(index, j){return [j, index];};
		var vakPositie=(function(){
				var pos=function(i){return [Math.floor(i/3),i%3];};
				return function(index,j){
					var vakPos=pos(index);
					var jPos=pos(j);
					return [
						3*vakPos[0]+jPos[0],
						3*vakPos[1]+jPos[1]
					];
				};
			})();
		var vak2Positie=function(index, j){
			var vakPos=[1+4*(Math.floor(index/2)),1+4*(index%2)];
			var jPos=[Math.floor(j/3),j%3];
			return [
				vakPos[0]+jPos[0],
				vakPos[1]+jPos[1]
			];
		};
		var vakIndex=function(r,k){
			var vakrij=Math.floor(r/3);
			var vakkolom=Math.floor(k/3);
			return 3*vakrij+vakkolom;
		};
		var vak2Index=function(r,k){
			if(r%4!=0&&k%4!=0){
				var switcher=function(t){if(t<4){return 0;}else{return 1;}};
				return 2*switcher(r)+switcher(k);
			}else{
				return -1;
			}
		};
		var volgendeCel=function(rij, kolom){
			var r,k;
			if(kolom<8){
				r=rij;
				k=kolom+1;
			}else{
				if(rij<8){
					r=rij+1;
					k=0;
				}else{
					r=0;
					k=0;
				}
			}
			return {rij:r,kolom:k};
		};
		var leeg=function(){
			var g=[];
			for(var i=0;i<9;i++){g.push([0,0,0,0,0,0,0,0,0]);}
			return g;
		};
		var Permutatielijst=function(n){
			var nullen=function(){
				var l=[];
				for(var i=0;i<n;i++){l.push(0);}
				return l;
			};
			var klaar=false;
			var tak=(function(){
				var huidig=nullen();
				var gaVerder=function(){
					var p=n-1;
					while(p>=0){
						if(huidig[p]<n-1-p){
							huidig[p]++;
							return true;
						}else{
							huidig[p]=0;
							p--;
						}
					}
					return false;
				};
				var permutatie=(function(indexLijst){
					return function(){
						var p=nullen();
						var i, j, k, index;
						for(i=0;i<n;i++){
							k=-1;
							index=huidig[i];
							for(j=0;j<n;j++){
								if(p[j]==0){k++;}
								if(k==index){
									p[j]=indexLijst[i];
									break;
								}
							}
						}
						return p;
					};
				})((function(n){
					var oud=[];
					for(var i=0;i<n;i++){
						oud.push(i+1);
					}
					var nieuw=[];
					while(oud.length>0){
						nieuw.push(oud.splice(Math.floor(Math.random()*oud.length),1)[0]);
					}
					return nieuw;
				})(n));
				return {huidig:function(){return huidig;},gaVerder:gaVerder,permutatie:permutatie};

			})();
			var eerste=true;
			var volgende=function(){
				if(eerste){
					eerste=false;
					return tak.permutatie();
				}else{
					if(tak.gaVerder()){
						return tak.permutatie();
					}else{
						klaar=true;
						return null;
					}
				}
			};
			return {volgende:volgende,isKlaar:function(){return klaar;}};
		};
		var versie=function(getallen, andereToestand){
			var gi,g=[];
			
			for(var i=0;i<9;i++){
				gi=[];
				for(var j=0;j<9;j++){
					gi.push(getallen[i][j]);
				}
				g.push(gi);
			}
			var zet=function(rij, kolom, n){
				g[rij][kolom]=n;
			};
			var checkVerzameling=function(positie){
				return function(index, callbackFalse){
					var pos,hier,gehad=[0,0,0,0,0,0,0,0,0];
					for(var j=0;j<9;j++){
						pos=positie(index,j);
						hier=g[pos[0]][pos[1]];
						if(hier>0){
							if(gehad[hier-1]>0){if(callbackFalse){callbackFalse();}return false;}else{
								gehad[hier-1]++;
							}
						}
					}
					return true;
				};
			};
			var verzamelingenMetGetal=function(positie, aantalVerzamelingen){
				return function(n){
					var pos, v=[];
					for(var i=0;i<aantalVerzamelingen;i++){
						for(var j=0;j<9;j++){
							pos=positie(i,j);
							if(g[pos[0]][pos[1]]==n){
								v.push(i);
								break;
							}
						}
					}
					return v;
				};
			};
			var checkRij=checkVerzameling(rijPositie);
			var checkKolom=checkVerzameling(kolomPositie);
			var checkVak=checkVerzameling(vakPositie);
			var checkVak2=checkVerzameling(vak2Positie);
			var checkKolommen=function(){
				for(var i=0;i<9;i++){if(!checkKolom(i)){return false;}}
				return true;
			};
			var checkVakken=function(rijIndex){
				var vakRij=Math.floor(rijIndex/3);
				for(var i=0;i<3;i++){
					if(!checkVak(3*vakRij+i)){return false;}
				}
				return true;
			};
			var checkVakken2=function(rijIndex){
				if(rijIndex%4==0){return true;}else{
					if(rijIndex<4){return checkVak2(0)&&checkVak2(1);}else{return checkVak2(2)&&checkVak2(3);}
				}
			};
			var check=(function(t){
				if(t){
					return function(vanuitRij){
						return checkKolommen()&&checkVakken(vanuitRij)&&checkVakken2(vanuitRij);
					};
				}else{
					return function(vanuitRij){
						return checkKolommen()&&checkVakken(vanuitRij);
					};
				}
			})(andereToestand);
			var checkAlles=function(){
				return check(1)&&check(4)&&check(7);
			};
			var rijenMetGetal=verzamelingenMetGetal(rijPositie, 9);
			var kolommenMetGetal=verzamelingenMetGetal(kolomPositie, 9);
			var vakkenMetGetal=verzamelingenMetGetal(vakPositie, 9);
			var vakken2MetGetal=verzamelingenMetGetal(vak2Positie, 4);
			var getallenRij=function(){
				var arr1=[];
				for(var i=0;i<9;i++){
					arr1.push(g[i].join(''));
				}
				return arr1.join('');
			};
			return {
				getallen:function(){return g;},
				zet:function(rij, kolom, n){zet(rij, kolom, n);return this;},
				checkRij:checkRij,
				checkKolom:checkKolom,
				checkVak:checkVak,
				checkVak2:checkVak2,
				checkKolommen: checkKolommen,
				checkVakken:checkVakken,
				rijenMetGetal:rijenMetGetal,
				kolommenMetGetal:kolommenMetGetal,
				vakkenMetGetal:vakkenMetGetal,
				vakken2MetGetal:vakken2MetGetal,
				check:check,
				checkAlles:checkAlles,
				getallenRij:getallenRij
			};
		};
		var gegeven=versie(leeg());

		var vulIn=function(v, regularUpdate, callSuccess, callFailure){
			var go;
			var getallenOver=(function(getallen){
				var o=[];
				var allemaal=function(){return [1,2,3,4,5,6,7,8,9];};
				for(var i=0;i<9;i++){
					var oi=allemaal();
					var g=getallen[i];
					var index;
					for(var j=0;j<9;j++){
						if(g[j]!=0){
							index=oi.indexOf(g[j]);
							oi.splice(index,1);
						}
					}
					o.push(oi);
				}
				return o;
			})(v.getallen()); 

			var permutatoren=(function(over){
				var p=[];
				var vernieuw=[];
				for(var i=0;i<9;i++){
					vernieuw.push((function(index, size){
						return function(){
							p[index]=Permutatielijst(size);
						};
					})(i,over[i].length));
				}
				for(var i=0;i<9;i++){
					vernieuw[i]();
				}
				var zijnKlaar=function(){
					for(var i=0;i<9;i++){
						if(!p[i].isKlaar()){return false;}
					}
					return true;
				};
				return {vernieuw:vernieuw,item:function(i){return p[i];},zijnKlaar:zijnKlaar}
			})(getallenOver);

			var vulRij=(function(over, getallen){
				var vul=[];
				for(var i=0;i<9;i++){
					vul.push((function(index, over, getallen){
						var plekken=[];
						for(var i=0;i<9;i++){
							if(getallen[i]==0){plekken.push(i);}
						}
						return function(permutatie){
							for(var i=0;i<over.length;i++){
								v.zet(index, plekken[permutatie[i]-1], over[i]);
							}
						};

					})(i, over[i], getallen[i]));
				}
				return vul;
			})(getallenOver, v.getallen());

			var maakRijLeeg=(function(getallen){
				var maak=[];
				for(var i=0;i<9;i++){
					maak.push((function(index, getallen){
						var plekken=[];
						for(var i=0;i<9;i++){
							if(getallen[i]==0){plekken.push(i);}
						}
						return function(){
							for(var i=0;i<plekken.length;i++){
								v.zet(index, plekken[i], 0);
							}
						};
					})(i, getallen[i]));
				}
				return maak;
			})(v.getallen());


			var huidigeRij=0;
			var teller=0;
			var p;
			var doorgaan=function(){
				return huidigeRij>-1&&huidigeRij<9&&(!permutatoren.zijnKlaar());
			};
			var klaar=function(){
				if(huidigeRij==9){
					var doorstart=false;
					if(callSuccess){doorstart=callSuccess(v.getallen());}
					if(doorstart){
						huidigeRij--;
						go();
					}
				}else{
					if(callFailure){callFailure();}
				}
			};
			var doeStap=function(){
				if(p=permutatoren.item(huidigeRij).volgende()){
					vulRij[huidigeRij](p);
					if(v.check(huidigeRij)){
						huidigeRij++;
					}
				}else{
					maakRijLeeg[huidigeRij]();
					permutatoren.vernieuw[huidigeRij]();
					huidigeRij--;
				}
			};
			go=(function(callback){
				if(callback){
					return function(){
						teller=0;
						while(teller<200000&&doorgaan()){
							doeStap();
							teller++;
						}
						callback(v.getallen(), huidigeRij/8);
						if(doorgaan()){setTimeout(go, 2);}else{
							klaar();
						}
					};
				}else{
					return function(){
						while(doorgaan()){
							doeStap();
						}
						klaar();
					};
				}
			})(regularUpdate);
			if(regularUpdate){console.log("updating");regularUpdate(v.getallen(), huidigeRij/8);}
			go();
		};

		var random=function(){
			var v=versie(leeg());
			vulIn(v);
			var verwijderEen=(function(getallen){
				var aanwezig=[];
				for(var i=0;i<81;i++){
					aanwezig.push((function(i){
						var rij=Math.floor(i/9);
						var kolom=i%9;
						return {r:rij,k:kolom,g:getallen[rij][kolom]};
					})(i));
				}
				return function(){
					var i=Math.floor(aanwezig.length*Math.random());
					var welke=aanwezig[i];
					v.zet(welke.r, welke.k, 0);
					aanwezig.splice(i,1);
				};
			})(v.getallen());
			for(var i=0;i<50;i++){
				verwijderEen();
			}
			return v;
		};

		return {
			zet: function(rij,kolom,n){gegeven.zet(rij,kolom,n);if(hash){hash.update();}},
			getallen:gegeven.getallen,
			getallenRij: gegeven.getallenRij,
			versie: versie,
			vulIn: vulIn,
			leeg:leeg,
			rijPositie:rijPositie,
			kolomPositie:kolomPositie,
			vakPositie:vakPositie,
			vak2Positie:vak2Positie,
			volgendeCel: volgendeCel,
			vakIndex: vakIndex,
			vak2Index: vak2Index,
			random: random
		};
	})();
	var editor=(function(){
		var editor=document.createElement('div');
		var littleThing;
		editor.setAttribute('style', 'width:450px;height:450px;position:relative');
		var form=(function(){
			var node=document.createElement('div');
			node.setAttribute('style', 'width:450px;height:450px');
			var cellFunctions=(function(functionNames){
				var f={};
				for(var i=0;i<functionNames.length;i++){
					f[functionNames[i]]={total: [], row:[]};
				}
				return {
					pushRow: function(){
						for(var i=0;i<functionNames.length;i++){
							f[functionNames[i]].total.push(f[functionNames[i]].row);
							f[functionNames[i]].row=[];
						}
					},
					addFunctions: function(functionArray){
						for(var i=0;i<functionNames.length;i++){
							f[functionNames[i]].row.push(functionArray[i]);
						}
					},
					finalize: function(){
						for(var i=0;i<functionNames.length;i++){
							f[functionNames[i]]=f[functionNames[i]].total;
						}
						return f;
					}
				};
			})(["makeRed", "makeNotRed", "setValue", "toggleInitialColor", "eliminateFrom", "resetPossibilitiesFor", "fillRemainingPossibility", "getPossibilities", "hasValue", "togglePossibilitiesView"]);
			var otherState=false;
			var highlighting=false;
			var table=document.createElement('table');
			table.setAttribute('style','width:100%;height:100%;margin:0px;padding:0px;border-spacing:0px;color:inherit');
			for(var i=0;i<9;i++){
				table.appendChild((function(row){
					var tr=document.createElement('tr');
					tr.setAttribute('style','margin:0px;padding:0px;border-spacing:0px');
					for(var i=0;i<9;i++){
						tr.appendChild((function(index){
							var td=document.createElement('td');
							td.setAttribute('style','margin:0px;padding:0px;border-spacing:0px');
							td.appendChild((function(){
								var div=document.createElement('div');
								var vakIndex=sudoku.vakIndex(row, index);
								var vak2Index=sudoku.vak2Index(row, index);
								var initialColor="#FFFFFF";
								var border=function(side, thickness){
									var s;
									switch(side){
										case 0:s="border-top";break;
										case 1:s="border-right";break;
										case 2:s="border-bottom";break;
										case 3:s="border-left";break;
									}
									return s+":"+thickness+"pt solid #000;";
								};
								div.setAttribute('style','position:relative;width:100%;height:100%;'+border(0,row==0?3:1)+border(1,index==8?3:1)+border(3,(index==0||index%3==0)?3:1)+border(2,(row==8||row%3==2)?3:1)+'background-color:'+initialColor);
								div.setAttribute('align', 'center');
								var input=document.createElement('input');
								input.setAttribute('type', 'text');
								input.setAttribute('maxlength', 1);
								input.setAttribute('style', 'border:0px;width:50%;font-size:20px;position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);background-color:transparent');
								var makeRed_=function(color){
									div.style.backgroundColor=color?color:"#FF0000";
								};
								var makeNotRed_=function(){
									div.style.backgroundColor=initialColor;
								};
								var toggleInitialColor_=(function(ind){
									var on=false;
									return function(){
										if(on){
											initialColor="#FFFFFF";
											makeNotRed_();
											on=false;
										}else{
											initialColor=ind==-1?"#FFFFFF":"#BBBBBB";
											makeRed_(initialColor);
											on=true;
										}
									};
								})(vak2Index);
								var setValue_=function(v, commit){
									input.value=v;
									if(commit){commitValue(v);}	
								};
								var hidePossibilities=function(){possibilities.hide();};
								var commitValue=function(v){
									if(v){
										form.eliminateFromRow(row, v);
										form.eliminateFromColumn(index, v);
										form.eliminateFromSquare(vakIndex, v);
										if(otherState&&vak2Index>-1){form.eliminateFromSquare2(vak2Index, v);}
										hidePossibilities();
									}
								};
								var ignore=false;
								input.onfocus=function(){
									var v=input.value;
									if(v){
										var highlight=function(arr, f){
											if(highlighting){
												for(var i=0;i<arr.length;i++){
													f(arr[i], "#BB5555");
												}
											}
										};
										var versie=sudoku.versie(sudoku.getallen());
										highlight(versie.rijenMetGetal(parseInt(v)), form.makeRedRow);
										highlight(versie.kolommenMetGetal(parseInt(v)), form.makeRedColumn);
										highlight(versie.vakkenMetGetal(parseInt(v)), form.makeRedSquare);
										if(otherState){highlight(versie.vakken2MetGetal(parseInt(v)), form.makeRedSquare2);}
									}
								};
								input.onkeyup=function(){
									var v=input.value;
									if(v!=""&&v.match(/[1-9]/g)==null){
										makeRed_();
										ignore=true;
									}else{
										form.makeNotRed();
										if(v!=""){
											var n=parseInt(v);
											var versie=sudoku.versie(sudoku.getallen()).zet(row, index, n);
											var check=versie.checkKolom(index, function(){ignore=true;form.makeRedColumn(index);})&&versie.checkRij(row, function(){ignore=true;form.makeRedRow(row);})&&versie.checkVak(vakIndex, function(){ignore=true;form.makeRedSquare(vakIndex);})&&((otherState&&vak2Index!=-1)?versie.checkVak2(vak2Index, function(){ignore=true;form.makeRedSquare2(vak2Index);}):true);
											if(check){
												sudoku.zet(row, index, n);
												moves.make(row, index, n);
												setValue_(n, true);
												ignore=false;
											}
										}else{
											sudoku.zet(row, index, 0);
											form.setAll(sudoku.getallen());
										}
									}
								};
								input.onblur=function(){
									if(ignore){
										setValue_("");
									}
									form.makeNotRed();
									//var v=parseInt(input.value);
									//if(v){commitValue(v);};
								}
								div.appendChild(input);
								var possibilities=(function(){
									var hidden=false;
									var showingPossibilities=true;
									var node=document.createElement('div');
									node.setAttribute('style','position:absolute;left:0px;top:0px;font-family:Arial;color:#999999;font-size:8px');
									var p=[1,2,3,4,5,6,7,8,9];
									var toString=function(){return p.join('');};
									var display=function(){if(!hidden&&showingPossibilities){node.innerHTML=toString();}};
									var eliminate=function(n){
										if(n){
											var i=p.indexOf(n);
											if(i>-1){
												p.splice(i,1);
												display();
											}
										}
									};
									var hide=function(){node.innerHTML='';hidden=true;};
									var reset=function(){hidden=false;p=[1,2,3,4,5,6,7,8,9];display();};
									var get=function(){return (!hidden)?p:null;};
									var toggleView=function(){
										showingPossibilities=!showingPossibilities;
										if(showingPossibilities){display();}else{node.innerHTML='';}
									};
									display();
									return {node:node,eliminate:eliminate,toString:toString,reset:reset,hide:hide,get:get, toggleView:toggleView};

								})();
								var fillRemainingPossibility_=(function(poss){
									return function(){
										var pos=possibilities.get();
										if((!input.value)&&pos.length==1){
											console.log("filling");
											var toSet=pos[0];
											setValue_(toSet, true);
											sudoku.zet(row, index, toSet);
										}
									};
								})(possibilities);
								var hasValue=function(){return input.value!="";}
								cellFunctions.addFunctions([makeRed_, makeNotRed_, setValue_, toggleInitialColor_, possibilities.eliminate, possibilities.reset, fillRemainingPossibility_, possibilities.get, hasValue, possibilities.toggleView]);
								div.appendChild(possibilities.node);
								return div;
							})());
							return td;
						})(i));
					}
					return tr;
				})(i));
				cellFunctions.pushRow();
			}
			cellFunctions=cellFunctions.finalize();
			node.appendChild(table);
			var layover=(function(parent){
				var node=document.createElement('div');
				var setText;
				node.setAttribute('style', 'position:absolute;left:0px;top:0px;width:455px;height:450px;background-color:rgba(255,255,255,0.75);display:none');
				node.setAttribute('align','center');
				node.appendChild((function(){
					var node=document.createElement('span');
					node.setAttribute('style','position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);font-family:Verdana;font-size:20px;color:#000');
					node.appendChild(document.createTextNode("hoi"));
					setText=function(text, color){
						node.innerHTML="";node.appendChild(document.createTextNode(text));
						node.style.color=color?color:"#000";
					};
					return node;
				})());
				node.onclick=function(){
					node.style.display="none";
				};
				parent.appendChild(node);
				return {setText:function(text, color){node.style.display="initial";setText(text, color);}};
			})(node);
			editor.appendChild(node);
			var toggleHighlighting=function(){
				highlighting=!highlighting;
			};
			var makeRedSet=function(posF){
				var position=function(index){return function(j){return posF(index, j);};};
				return function(i, color){
					var p, pos=position(i);
					for(var j=0;j<9;j++){
						p=pos(j);
						cellFunctions.makeRed[p[0]][p[1]](color);
					}
				};
			};
			var eliminateFromSet=function(posF){
				var position=function(index){return function(j){return posF(index, j);};};
				return function(i, n){
					var p, pos=position(i);
					for(var j=0;j<9;j++){
						p=pos(j);
						cellFunctions.eliminateFrom[p[0]][p[1]](n);
					}
				};
			};
			var filler=(function(){
				var r=0;
				var k=0;
				var going=false;
				var go=function(){
					cellFunctions.fillRemainingPossibility[r][k]();
					var next=sudoku.volgendeCel(r,k);
					r=next.rij;
					k=next.kolom;
					if(going){setTimeout(go, 20);}
				};
				var stop=function(){going=false;};
				return {go:function(){going=true;go();},stop:stop}
			})();
			var allCells=function(cellFunction){
				for(var i=0;i<9;i++){
					for(var j=0;j<9;j++){
						cellFunction[i][j]();
					}
				}
			};
			var getTwinsInSets=(function(){
				var arrayEquals=function(arr1, arr2){
					if(!arr1||!arr2){return false;}
					if(arr1.length!=arr2.length){return false;}
					for(var i=0;i<arr1.length;i++){
						if(arr1[i]!=arr2[i]){return false;}
					}
					return true;
				};
				return function(posF, numberOfSets){
					return function(){
						var p, p1,p2,poss, allTwins, twins, waarZit, getallen;
						allTwins=[];
						for(var k=0;k<numberOfSets;k++){
							twins=[];
							waarZit=[[],[],[],[],[],[],[],[],[]];
							getallen=sudoku.getallen();
							for(var i=0;i<9;i++){
								p=posF(k,i);
								if(!getallen[p[0]][p[1]]){
									poss=cellFunctions.getPossibilities[p[0]][p[1]]();
									for(var j=0;j<poss.length;j++){
										waarZit[poss[j]-1].push(i);
									}
								}
							}

							//see if there are two numbers that only occur in two places
							for(var i=0;i<9;i++){
								for(var j=i+1;j<9;j++){
									if(waarZit[i].length==2&&arrayEquals(waarZit[i], waarZit[j])){
										twins.push([[i+1,j+1],[posF(k, waarZit[i][0]), posF(k, waarZit[i][1])]]);
									}
								}
							}

							//see if there are two places that have the same 2 possibilities
							for(var i=0;i<9;i++){
								for(var j=i+1;j<9;j++){
									p1=posF(k, i);
									p2=posF(k,j);
									poss=cellFunctions.getPossibilities[p1[0]][p1[1]]();
									if(poss&&poss.length==2&&arrayEquals(poss, cellFunctions.getPossibilities[p2[0]][p2[1]]())){
										twins.push([poss,[p1,p2]]);
									}
								}
							}
							if(twins.length>0){allTwins.push(twins)};
						}
						return JSON.stringify(allTwins);
					};
				};
			})();
			var r= {
				toggleHighlighting: toggleHighlighting,
				display: function(text, color){layover.setText(text, color);},
				makeRedRow: makeRedSet(sudoku.rijPositie),
				makeRedColumn: makeRedSet(sudoku.kolomPositie),
				makeRedSquare: makeRedSet(sudoku.vakPositie),
				makeRedSquare2: makeRedSet(sudoku.vak2Positie),
				eliminateFromRow: eliminateFromSet(sudoku.rijPositie),
				eliminateFromColumn: eliminateFromSet(sudoku.kolomPositie),
				eliminateFromSquare: eliminateFromSet(sudoku.vakPositie),
				eliminateFromSquare2: eliminateFromSet(sudoku.vak2Positie),
				startFilling: function(){filler.go();},
				stopFilling: function(){filler.stop();},
				makeNotRed: function(){
					allCells(cellFunctions.makeNotRed);
				},
				resetPossibilities: function(){
					allCells(cellFunctions.resetPossibilitiesFor);
				},
				toggleKind: function(){
					otherState=!otherState;
					allCells(cellFunctions.toggleInitialColor);
					if(hash){hash.update();}
				},
				togglePossibilitiesView: function(){
					allCells(cellFunctions.togglePossibilitiesView);
				},
				setAll: function(numbers){
					r.resetPossibilities();
					var n;
					for(var i=0;i<9;i++){
						for(var j=0;j<9;j++){
							n=numbers[i][j]||0;
							cellFunctions.setValue[i][j](n==0?'':n, true);
							sudoku.zet(i, j, n);
						}
					}
				},
				otherState:function(){return otherState},
				getTwinsInRows: getTwinsInSets(sudoku.rijPositie, 9),
				getTwinsInColumns: getTwinsInSets(sudoku.kolomPositie, 9),
				getTwinsInSquares: getTwinsInSets(sudoku.vakPositie, 9)
			};
			return r;
		})();
		var panel=(function(parent){
			var initialSize=7;
			var node=document.createElement('div');
			node.setAttribute('align', 'center');
			node.setAttribute('style','position:absolute;left:0px;bottom:0px;width:'+(initialSize+5)+'px;height:'+initialSize+'px;background-color:rgb(0,0,0);border:3pt solid #000');
			var setProgressBar=(function(parent){
				var node0=document.createElement('div');
				node0.setAttribute('style','width:450px;height:450px;position:relative');
				node0.setAttribute('align', 'left');
				var node=document.createElement('div');
				node.setAttribute('style','position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);background-color:#000;height:50px;width:50%');
				node0.appendChild(node);
				var nodeAppended=false;
				return function(p){
					if(!nodeAppended){parent.removeChild(controls);parent.appendChild(node0);nodeAppended=true;}
					node.style.width=(p*100)+"%";
					if(p==-1&&nodeAppended){
						parent.removeChild(node0);
						parent.appendChild(controls);
						nodeAppended=false;
					}
				};
			})(node);
			var controls=(function(){
				var node=document.createElement('div');
				node.setAttribute('style','position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%)');
				var button=function(text, action){
					var node=document.createElement('div');
					node.setAttribute('style','-webkit-appearance:button;width:75px;height:30px;cursor:pointer;margin:0px;font-family:Verdana;font-size:12px;margin:5px');
					node.setAttribute('align','center');
					node.appendChild((function(){
						var div=document.createElement('div');
						div.setAttribute('style','position:relative;top:50%;transform:translateY(-50%)');
						div.appendChild(document.createTextNode(text));
						return div;
					})());
					node.onclick=function(e){e.cancelBubble=true;action();};
					return node;
				};
				var checkBox=function(text, action, initialChecked){
					var span=document.createElement('span');
					span.appendChild(document.createTextNode(text));
					var node=document.createElement('input');
					node.setAttribute('type', 'checkbox');
					if(initialChecked){node.setAttribute('checked','true');}
					node.onclick=function(){action(node);};
					span.appendChild(node);
					return span;
				};
				var buttons=[
					['GO', function(){
						form.stopFilling();
						var getallen=sudoku.versie(sudoku.getallen()).getallen();
						sudoku.vulIn(
							sudoku.versie(sudoku.getallen(), form.otherState()),
							function(d, p){form.setAll(d);setProgressBar(Math.max(0, Math.min(p,1)));},
							function(){setProgressBar(-1);return false;},
							function(){form.setAll(getallen);setProgressBar(-1);setText("geen oplossing!", "rgb(150,0,0)");}
							);
					}],
					['Clear', function(){form.setAll(sudoku.leeg());}],
					['Undo', function(){if(moves){moves.back();}}],
					['Undo all', function(){if(moves){while(moves.back()){}}}],
					['random',function(){form.setAll(sudoku.random().getallen());hash.update();}],
					['?', function(){
						var n=0;
						var klaar=function(){
							if(n!=0){setText(n==1?"eenduidig":"niet eenduidig", n==1?"rgb(0,150,0)":"rgb(200,150,0)");}
						};
						sudoku.vulIn(
							sudoku.versie(sudoku.getallen(), form.otherState()),
							function(d,p){setProgressBar(Math.max(0, Math.min(p,1)));},
							function(d){
								n++;
								if(n==1){
									return true;
								}else{
									setProgressBar(-1);
									setText("niet eenduidig", "rgb(200,150,0)");
									return false;
								}
							},
							function(){
								setProgressBar(-1);
								if(n==0){
									setText("geen oplossing!", "rgb(150,0,0)");
								}else{
									setText("eenduidig", "rgb(0,150,0)");
								}
							}
							);
					}]
				];
				var checkBoxes=[
					['andere', function(node){
						if(node.checked){
							var check=sudoku.versie(sudoku.getallen(), true).checkAlles();
							if(check){
								form.toggleKind();
							}else{
								node.checked=false;
							}
						}else{
							form.toggleKind();
						}
					}],
					['mogelijkheden', function(){form.togglePossibilitiesView();}, true],
					['autofill', (function(){
						var filling=false;
						return function(){
							if(!filling){
								filling=true;
								form.startFilling();
							}else{
								form.stopFilling();
								filling=false;
							}
						};
					})()],
					['highlight', function(){form.toggleHighlighting();}]

				];
				for(var i=0;i<buttons.length;i++){
					node.appendChild(button(buttons[i][0], buttons[i][1]));
				}
				for(var i=0;i<checkBoxes.length;i++){
					node.appendChild(checkBox(checkBoxes[i][0], checkBoxes[i][1], checkBoxes[i][2]));
				}
				return node;
			})();
			var setText=(function(parent){
				var node0=document.createElement('div');
				node0.setAttribute('style','width:450px;height:450px;position:relative');
				var node=document.createElement('span');
				node.setAttribute('style','position:relative;top:50%;transform:translateY(-50%);-webkit-transform:translateY(-50%);font-family:Verdana;font-size:20px;color:#000');
				node.appendChild(document.createTextNode("hoi"));
				node0.appendChild(node);
				return function(text, color){
					console.log("setting text");
					parent.removeChild(controls);
					parent.appendChild(node0);
					node.innerHTML="";node.appendChild(document.createTextNode(text));
					node.style.color=color?color:"#000";
					parent.onclick=function(){parent.removeChild(node0);parent.appendChild(controls);};
				};
			})(node);
			var changeSizeTo=(function(initial, node){
				var s=initial;
				var g;
				var d, d0;
				var callback;
				var setSize=function(){
					node.style.width=(s+5)+"px";
					node.style.height=s+"px";
				};
				var makeStep=function(){
					s=s+(g-s)/2;
					d=d/2;
					setSize();
					if(d>d0/100){
						setTimeout(makeStep, 20);
					}else{
						s=g;
						setSize();
						callback();
					}
				};
				return function(g_, callback_){
					g=g_;
					d=Math.abs(s-g_);
					d0=d;
					callback=callback_||function(){};
					makeStep();
				};
			})(initialSize, node);
			var closeButton=(function(){
				var node=document.createElement('div');
				node.setAttribute('style', 'position:absolute;right:4px;top:4px;background-color:rgb(0,0,0);width:12px;height:12px');
				node.onclick=function(e){hide(e);};
				return node;
			})();
			parent.appendChild(node);
			var show=function(){
				node.style.backgroundColor="rgba(255,255,255,0.75)";
				changeSizeTo(442, function(){
					node.appendChild(controls);
					node.appendChild(closeButton);
					node.onclick=function(){};
				});
			};
			var hide=function(e){
				e.preventDefault();
				e.cancelBubble=true;
				node.removeChild(controls);
				node.removeChild(closeButton);
				changeSizeTo(initialSize, function(){
					node.style.backgroundColor="rgb(0,0,0)";
					node.onclick=show;
				});
			};
			node.onclick=show;
			return {show:show,hide:hide, setText:setText};
		})(editor);
		b.appendChild(editor);
		return {setAll:form.setAll,otherState:form.otherState,toggleKind:form.toggleKind,startFilling:form.startFilling, stopFilling: form.stopFilling,getTwinsInSquares: form.getTwinsInSquares,getTwinsInRows:form.getTwinsInRows, getTwinsInColumns: form.getTwinsInColumns, display:panel.setText};
	})();
	var hash=(function(){
		var update=function(){
			setHash((editor.otherState()?"1_":"0_")+sudoku.getallenRij());
		};
		var process=function(){
			var h=getHash();
			if(h){
				if(h[0]==="1"){editor.toggleKind();}
				h=h.substr(2);
				var getallen=[];
				for(var i=0;i<9;i++){
					getallen.push((function(row){
						var r=[];
						for(var i=0;i<9;i++){
							r.push(parseInt(row[i]));
						}
						return r;
					})(h.substr(i*9,9)));
				}
				if(!sudoku.versie(getallen).checkAlles()){return false;}
				editor.setAll(getallen);
				return true;
			}
			return false;
		};
		return {update:update,process:process};
	})();
	var list=(function(){
		var l=[
			[[0,7,0,0,0,5,0,0,0],[5,0,0,7,2,0,0,9,0],[8,0,0,0,0,0,0,0,0],[0,2,5,0,0,4,0,0,0],[0,0,6,3,7,1,5,0,0],[0,0,0,5,0,0,6,7,0],[0,0,0,0,0,0,0,0,2],[0,5,0,0,6,8,0,0,3],[0,0,0,9,0,0,0,1,0]],
			[[0,2,0,0,4,8,0,5,3],[0,0,0,3,0,0,0,6,0],[0,0,3,0,0,6,1,0,0],[1,0,0,0,0,0,0,0,0],[0,8,0,5,0,7,0,2,0],[0,0,0,0,0,0,0,0,1],[0,0,9,6,0,0,8,0,0],[0,3,0,0,0,5,0,0,0],[7,5,0,8,9,0,0,4,0]],
			[[0,1,0,0,0,0,0,0,0],[4,0,0,0,8,7,0,5,0],[0,7,0,0,0,3,6,0,0],[6,0,0,2,0,0,8,0,0],[0,4,2,0,0,0,7,3,0],[0,0,9,0,0,4,0,0,2],[0,0,8,9,0,0,0,7,0],[0,6,0,7,1,0,0,0,8],[0,0,0,0,0,0,0,2,0]],
			[[0,0,7,0,1,0,0,2,0],[6,0,8,0,0,3,0,0,0],[5,0,0,9,0,0,0,4,8],[0,0,0,0,0,8,0,0,6],[0,0,4,0,0,0,5,0,0],[1,0,0,5,0,0,0,0,0],[9,5,0,0,0,7,0,0,4],[0,0,0,6,0,0,7,0,3],[0,4,0,0,8,0,9,0,0]],
			[[0,0,0,0,8,0,7,0,2],[0,5,0,0,1,0,3,0,0],[0,2,0,3,0,0,0,8,0],[0,0,0,0,0,0,1,9,5],[0,4,0,0,0,0,0,3,0],[5,1,9,0,0,0,0,0,0],[0,8,0,0,0,2,0,4,0],[0,0,2,0,7,0,0,5,0],[3,0,1,0,9,0,0,0,0]],
			[[0,0,0,0,0,0,0,9,7],[0,0,0,8,0,0,1,0,0],[0,0,0,0,0,1,0,6,2],[0,4,0,0,7,0,3,0,1],[0,0,5,0,4,0,7,0,0],[2,0,6,0,3,0,0,5,0],[8,5,0,3,0,0,0,0,0],[0,0,1,0,0,2,0,0,0],[7,9,0,0,0,0,0,0,0]],
			[[0,7,6,0,0,0,0,0,0],[8,0,5,0,7,1,0,0,0],[3,0,0,0,9,0,0,0,0],[0,0,9,0,0,0,0,3,7],[0,8,0,3,0,2,0,4,0],[6,5,0,0,0,0,1,0,0],[0,0,0,0,1,0,0,0,3],[0,0,0,5,2,0,4,0,1],[0,0,0,0,0,0,9,6,0]],
			[[6,0,1,3,0,4,0,0,0],[3,4,0,0,0,5,1,0,0],[0,0,0,0,0,7,0,0,0],[2,0,0,0,5,8,0,0,0],[0,0,8,0,0,0,4,0,0],[0,0,0,7,6,0,0,0,9],[0,0,0,5,0,0,0,0,0],[0,0,9,8,0,0,0,2,7],[0,0,0,2,0,6,3,0,5]],
			[[7,0,0,0,0,0,0,5,2],[0,0,0,7,4,0,0,0,0],[2,0,0,0,0,8,9,0,0],[0,0,7,0,0,4,0,3,0],[0,6,0,0,2,0,0,1,0],[0,8,0,3,0,0,7,0,0],[0,0,4,6,0,0,0,0,1],[0,0,0,0,7,3,0,0,0],[8,9,0,0,0,0,0,0,6]]
		];
		var setRandom=function(){
			editor.setAll(l[Math.floor(Math.random()*l.length)]);
		};
		return {setRandom:setRandom};
	})();
	var moves=(function(){
		var list=[];
		var make=function(r, c, n){
			list.push({r:r,c:c,n:n});
		};
		var back=function(){
			if(list.length>0){
				var move=list.splice(list.length-1,1)[0];
				sudoku.zet(move.r, move.c, 0);
				editor.setAll(sudoku.getallen());
				if(list.length>0){
					return true;
				}
			}
			return false;
		};
		return {make:make,back:back}
	})();
	if(!hash.process()){editor.setAll(sudoku.random().getallen());hash.update();}
	window.sudoku=sudoku;
	window.editor=editor;
})(document.body, function(h){window.location.hash=h;}, function(){return window.location.hash.substr(1);});
</script>
</html>
